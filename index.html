<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protótipo - Lista de Tarefas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo para o modal (escondido por padrão) */
        #task-modal { display: none; }
        #task-modal.show { display: flex; }
        /* Estilo para tarefa concluída */
        .task-completed { text-decoration: line-through; opacity: 0.6; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 antialiased">

    <div class="max-w-2xl mx-auto p-4 md:p-8">
        
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-white">Minhas Tarefas da Semana</h1>
        </header>

        <div class="flex items-center justify-between bg-gray-800 p-4 rounded-lg mb-6">
            <button id="prev-week-btn" class="p-2 rounded-full hover:bg-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <h2 id="week-display" class="text-lg font-semibold text-center">Carregando...</h2>
            <button id="next-week-btn" class="p-2 rounded-full hover:bg-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
        </div>

        <div class="mb-6 text-center">
            <button id="add-task-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg w-full md:w-auto">
                + Nova Tarefa
            </button>
        </div>

        <div id="task-list" class="space-y-3">
            </div>

    </div>

    <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4">
        <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
            <h3 id="modal-title" class="text-xl font-bold mb-4">Nova Tarefa</h3>
            
            <form id="task-form">
                <input type="hidden" id="task-id">
                
                <div class="mb-4">
                    <label for="task-name" class="block text-sm font-medium text-gray-300 mb-1">Nome da Tarefa</label>
                    <input type="text" id="task-name" class="w-full bg-gray-700 text-white p-2 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                
                <div class="mb-4">
                    <label for="task-priority" class="block text-sm font-medium text-gray-300 mb-1">Prioridade</label>
                    <select id="task-priority" class="w-full bg-gray-700 text-white p-2 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="high">Alta</option>
                        <option value="medium">Média</option>
                        <option value="low">Baixa</option>
                    </select>
                </div>

                <div class="mb-6">
                    <label for="task-notes" class="block text-sm font-medium text-gray-300 mb-1">Anotações</label>
                    <textarea id="task-notes" rows="4" class="w-full bg-gray-700 text-white p-2 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>

                <div class="flex flex-col md:flex-row gap-2">
                    <button type="submit" id="save-task-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Salvar</o>
                    <button type="button" id="duplicate-task-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Duplicar</button>
                    <button type="button" id="cancel-btn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- VARIÁVEIS GLOBAIS ---
            let tasks = [
                { id: 1, name: "Revisar o protótipo", priority: "high", notes: "Verificar o JS", completed: false, weekKey: "2025-W47" },
                { id: 2, name: "Começar o backend", priority: "medium", notes: "Flask + Render", completed: false, weekKey: "2025-W47" },
                { id: 3, name: "Fazer café", priority: "low", notes: "", completed: true, weekKey: "2025-W47" },
                { id: 4, name: "Tarefa da semana passada", priority: "medium", notes: "", completed: false, weekKey: "2025-W46" },
            ];
            let currentDate = new Date('2025-11-17T12:00:00'); // Data fixa para o protótipo
            let currentWeekKey = getWeekKey(currentDate);

            // --- SELETORES DO DOM ---
            const taskList = document.getElementById('task-list');
            const prevWeekBtn = document.getElementById('prev-week-btn');
            const nextWeekBtn = document.getElementById('next-week-btn');
            const weekDisplay = document.getElementById('week-display');
            
            const addTaskBtn = document.getElementById('add-task-btn');
            const modal = document.getElementById('task-modal');
            const modalTitle = document.getElementById('modal-title');
            const taskForm = document.getElementById('task-form');
            const taskIdInput = document.getElementById('task-id');
            const taskNameInput = document.getElementById('task-name');
            const taskPriorityInput = document.getElementById('task-priority');
            const taskNotesInput = document.getElementById('task-notes');
            
            const saveTaskBtn = document.getElementById('save-task-btn');
            const duplicateTaskBtn = document.getElementById('duplicate-task-btn');
            const cancelBtn = document.getElementById('cancel-btn');

            // --- FUNÇÕES DE DATA ---
            
            // Retorna a chave da semana (ex: "2025-W47")
            function getWeekKey(date) {
                const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
                const dayNum = d.getUTCDay() || 7;
                d.setUTCDate(d.getUTCDate() + 4 - dayNum);
                const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
                const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
                return `${d.getUTCFullYear()}-W${String(weekNo).padStart(2, '0')}`;
            }

            // Retorna o texto da semana (ex: "17/Nov - 23/Nov")
            function getWeekRangeText(date) {
                const monday = new Date(date);
                const day = monday.getDay();
                const diff = monday.getDate() - day + (day === 0 ? -6 : 1); // Ajusta para Segunda
                monday.setDate(diff);

                const sunday = new Date(monday);
                sunday.setDate(monday.getDate() + 6);
                
                const options = { month: 'short', day: 'numeric' };
                return `${monday.toLocaleDateString('pt-BR', options)} - ${sunday.toLocaleDateString('pt-BR', options)}`;
            }
            
            function updateWeekDisplay() {
                weekDisplay.textContent = getWeekRangeText(currentDate);
                currentWeekKey = getWeekKey(currentDate);
            }

            // --- FUNÇÕES DE TAREFA ---

            // Mapeia prioridade para valor numérico para ordenar
            const priorityValues = { high: 1, medium: 2, low: 3 };

            // Classes de cor baseadas na prioridade
            const priorityClasses = {
                high: 'bg-red-900/50 border-red-500',
                medium: 'bg-yellow-900/50 border-yellow-500',
                low: 'bg-green-900/50 border-green-500'
            };

            function renderTasks() {
                // Limpa a lista
                taskList.innerHTML = '';
                
                // Filtra as tarefas pela semana atual
                const tasksOfWeek = tasks.filter(t => t.weekKey === currentWeekKey);

                // Ordena as tarefas: Requisito 4 (Prioridade)
                tasksOfWeek.sort((a, b) => {
                    // Primeiro, tarefas incompletas
                    if (a.completed !== b.completed) {
                        return a.completed ? 1 : -1;
                    }
                    // Segundo, por prioridade
                    return priorityValues[a.priority] - priorityValues[b.priority];
                });

                if (tasksOfWeek.length === 0) {
                    taskList.innerHTML = `<p class="text-gray-500 text-center">Sem tarefas para esta semana.</p>`;
                    return;
                }

                tasksOfWeek.forEach(task => {
                    const taskEl = document.createElement('div');
                    taskEl.dataset.id = task.id;
                    
                    // Requisito 5: Cores de prioridade
                    const colorClass = priorityClasses[task.priority];
                    
                    // Requisito 3: Checkbox, Nome, Prioridade
                    taskEl.className = `flex items-center p-4 rounded-lg border-l-4 cursor-pointer ${colorClass} ${task.completed ? 'task-completed' : 'bg-gray-800'}`;
                    
                    taskEl.innerHTML = `
                        <input type="checkbox" class="task-checkbox form-checkbox h-5 w-5 bg-gray-700 border-gray-600 rounded text-blue-500 focus:ring-0" ${task.completed ? 'checked' : ''}>
                        <span class="task-name flex-1 mx-4">${task.name}</span>
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${colorClass.replace('bg-', 'text-').split(' ')[0].replace('/50', '-300')}">${task.priority}</span>
                        <div classclass="ml-4 space-x-2">
                            <button class="edit-btn text-gray-400 hover:text-white" title="Editar">✏️</button>
                            <button class="delete-btn text-gray-400 hover:text-red-500" title="Excluir">❌</button>
                        </div>
                    `;
                    
                    taskList.appendChild(taskEl);
                });
            }

            // --- LÓGICA DO MODAL ---
            
            function openModal(task = null) {
                taskForm.reset();
                if (task) {
                    // Editando
                    modalTitle.textContent = 'Editar Tarefa';
                    taskIdInput.value = task.id;
                    taskNameInput.value = task.name;
                    taskPriorityInput.value = task.priority;
                    taskNotesInput.value = task.notes;
                    duplicateTaskBtn.style.display = 'block'; // Mostra Duplicar
                } else {
                    // Adicionando
                    modalTitle.textContent = 'Nova Tarefa';
                    taskIdInput.value = '';
                    taskPriorityInput.value = 'medium'; // Padrão
                    duplicateTaskBtn.style.display = 'none'; // Esconde Duplicar
                }
                modal.classList.add('show');
            }

            function closeModal() {
                modal.classList.remove('show');
            }

            function saveTask(e) {
                e.preventDefault();
                
                const id = taskIdInput.value;
                const taskData = {
                    name: taskNameInput.value,
                    priority: taskPriorityInput.value,
                    notes: taskNotesInput.value,
                    weekKey: currentWeekKey
                };

                if (id) {
                    // Atualizar tarefa existente
                    const index = tasks.findIndex(t => t.id == id);
                    if (index > -1) {
                        tasks[index] = { ...tasks[index], ...taskData };
                    }
                } else {
                    // Criar nova tarefa
                    taskData.id = Date.now(); // ID único
                    taskData.completed = false;
                    tasks.push(taskData);
                }
                
                renderTasks();
                closeModal();
            }

            function duplicateTask() {
                const taskData = {
                    id: Date.now(),
                    name: taskNameInput.value + " (Cópia)",
                    priority: taskPriorityInput.value,
                    notes: taskNotesInput.value,
                    completed: false,
                    weekKey: currentWeekKey
                };
                tasks.push(taskData);
                renderTasks();
                closeModal();
            }

            // --- EVENT LISTENERS ---

            // Navegação da Semana
            prevWeekBtn.addEventListener('click', () => {
                currentDate.setDate(currentDate.getDate() - 7);
                updateWeekDisplay();
                renderTasks();
            });

            nextWeekBtn.addEventListener('click', () => {
                currentDate.setDate(currentDate.getDate() + 7);
                updateWeekDisplay();
                renderTasks();
            });

            // Abrir Modal
            addTaskBtn.addEventListener('click', () => openModal());

            // Fechar Modal
            cancelBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal(); // Fecha se clicar fora
            });

            // Salvar / Duplicar
            taskForm.addEventListener('submit', saveTask);
            duplicateTaskBtn.addEventListener('click', duplicateTask);

            // Event Listeners na Lista de Tarefas (para Checkbox, Editar, Excluir)
            taskList.addEventListener('click', (e) => {
                const target = e.target;
                const taskEl = target.closest('[data-id]');
                if (!taskEl) return;
                
                const taskId = taskEl.dataset.id;
                const task = tasks.find(t => t.id == taskId);

                if (target.classList.contains('task-checkbox')) {
                    // Checkbox
                    task.completed = target.checked;
                    renderTasks(); // Re-renderiza para ordenar e aplicar estilo
                
                } else if (target.classList.contains('edit-btn') || target.classList.contains('task-name')) {
                    // Requisito 6 e 7: Editar
                    openModal(task);
                
                } else if (target.classList.contains('delete-btn')) {
                    // Requisito 7: Excluir
                    if (confirm(`Tem certeza que quer excluir "${task.name}"?`)) {
                        tasks = tasks.filter(t => t.id != taskId);
                        renderTasks();
                    }
                }
            });

            // --- INICIALIZAÇÃO ---
            updateWeekDisplay();
            renderTasks();
        });
    </script>
</body>
</html>